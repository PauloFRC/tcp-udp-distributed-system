syntax = "proto3";

enum DeviceType {
    UNKNOWN = 0;
    TEMPERATURE = 1;
    HUMIDITY = 2;
    ALARM = 3;
    LAMP_POST = 4;
    SEMAPHORE = 5;
}

message SensorReading {
    string sensor_id = 1;
    string location = 2;
    DeviceType sensor_type = 3;
    double value = 4;
    string unit = 5;
    int64 timestamp = 6;
    map<string, string> metadata = 7;
}

message Response {
    bool success = 1;
    string message = 2;
    int64 timestamp = 3;
}

message GatewayAnnouncement {
    string gateway_ip = 1;
    uint32 tcp_port = 2;
    uint32 udp_port = 3;
    uint32 command_port = 4;
}

message DeviceCommand {
  string target_id = 1; 
  string command = 2;
  int64 timestamp = 3;
}

message AppRequest {
    enum RequestType {
        LIST_DEVICES = 0;
        STREAM_LOCATION_DATA = 1;
        GET_ON_DEMAND_DATA = 2;
        QUEUE_COMMAND = 3;
    }

    message OnDemandRequest {
        string device_id = 1;
    }
    
    message StreamLocationRequest {
        string location_name = 1;
    }

    RequestType type = 1;
    oneof payload {
        StreamLocationRequest stream_request = 2;
        OnDemandRequest on_demand_request = 3;
        DeviceCommand command_request = 4;
    }
}

message GatewayResponse {
    enum ResponseType {
        DEVICE_LIST = 0;
        SINGLE_READING = 1;
        COMMAND_CONFIRMATION = 2;
    }

    message DeviceList {
        repeated SensorReading devices = 1;
    }

    ResponseType type = 1;
    oneof payload {
        DeviceList device_list = 2;
        SensorReading single_reading = 3;
        string confirmation_message = 4;
    }
}

message CommandResponse {
    bool success = 1;
    string message = 2;
}

message Empty {}

message SemaphoreLightStateRequest {
    string state = 1;
}

service DeviceControl {
    rpc SendCommand(CommandRequest) returns (CommandResponse);
    rpc SendTcpData(Empty) returns (CommandResponse);
    rpc SetSemaphoreLight(SemaphoreLightStateRequest) returns (CommandResponse);
}

message CommandRequest {
    string command = 1;
    map<string, string> params = 2;
}
